<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brokkr Saga - Character Bible</title>
    <style>
        :root {
            --primary-bg: #0d0e12;
            --card-bg: #1e2028;
            --accent-color: #bb8c65;
            --primary-text: #ffffff;
            --secondary-text: #a5a9b7;
            --border-color: #2a2c37;
            --search-bg: #2a2c37;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--primary-bg);
            color: var(--primary-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid var(--accent-color);
            margin-bottom: 30px;
        }

        h1 {
            color: var(--accent-color);
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--secondary-text);
            font-size: 1.1em;
        }

        .search-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            padding: 12px;
            background-color: var(--search-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--primary-text);
            font-size: 16px;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 8px 16px;
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--secondary-text);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab-button:hover,
        .tab-button.active {
            background-color: var(--accent-color);
            color: var(--primary-text);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .entry-card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.3s ease;
        }

        .entry-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-color);
        }

        .entry-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 15px;
        }

        .entry-name {
            color: var(--accent-color);
            font-size: 1.4em;
            font-weight: bold;
        }

        .entry-type {
            background-color: var(--accent-color);
            color: var(--primary-bg);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .entry-section {
            margin-bottom: 15px;
        }

        .section-title {
            color: var(--accent-color);
            font-weight: bold;
            margin-bottom: 5px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 2px;
        }

        .section-content {
            color: var(--primary-text);
            font-size: 0.95em;
        }

        .story-references {
            margin-top: 10px;
        }

        .story-tag {
            display: inline-block;
            background-color: var(--search-bg);
            color: var(--secondary-text);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.8em;
            margin-right: 5px;
            margin-bottom: 3px;
        }

        .edit-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .control-button {
            padding: 12px;
            background-color: var(--accent-color);
            color: var(--primary-text);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .control-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            max-width: 600px;
            width: 90%;
            margin: 5% auto;
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 30px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            color: var(--secondary-text);
            cursor: pointer;
        }

        .close-button:hover {
            color: var(--accent-color);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: var(--accent-color);
            font-weight: bold;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 10px;
            background-color: var(--search-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--primary-text);
            font-size: 14px;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .button {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .button-primary {
            background-color: var(--accent-color);
            color: var(--primary-text);
        }

        .button-secondary {
            background-color: var(--search-bg);
            color: var(--secondary-text);
        }

        .button:hover {
            opacity: 0.8;
        }

        .export-section {
            margin-top: 30px;
            padding: 20px;
            background-color: var(--search-bg);
            border-radius: 6px;
        }

        .notice {
            background-color: rgba(187, 140, 101, 0.1);
            border-left: 4px solid var(--accent-color);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .search-controls {
                flex-direction: column;
            }

            .content-grid {
                grid-template-columns: 1fr;
            }

            .edit-controls {
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Brokkr Saga Character Bible</h1>
            <p class="subtitle">Comprehensive reference for characters, timeline, and world-building</p>
        </header>

        <div class="notice">
            <p><strong>Note:</strong> This Character Bible is designed to help maintain consistency across all Brokkr Saga stories. Use the search and filter features to quickly find information, and the edit controls to add or modify entries.</p>
        </div>

        <div class="search-controls">
            <input type="text" class="search-box" id="searchBox" placeholder="Search characters, locations, concepts...">
            <div class="filter-tabs">
                <button class="tab-button active" data-type="all">All</button>
                <button class="tab-button" data-type="character">Characters</button>
                <button class="tab-button" data-type="location">Locations</button>
                <button class="tab-button" data-type="concept">Concepts</button>
                <button class="tab-button" data-type="timeline">Timeline</button>
            </div>
        </div>

        <div class="content-grid" id="contentGrid">
            <!-- Content will be dynamically loaded here -->
        </div>

        <div class="export-section">
            <h3>Export & Backup</h3>
            <p>Download your Character Bible data for backup or sharing:</p>
            <div class="form-buttons" style="margin-top: 10px;">
                <button class="button button-primary" onclick="exportData()">Export JSON</button>
                <button class="button button-secondary" onclick="document.getElementById('importFile').click()">Import JSON</button>
                <input type="file" id="importFile" style="display: none;" accept=".json" onchange="importData(event)">
            </div>
        </div>
    </div>

    <div class="edit-controls">
        <button class="control-button" onclick="openAddModal()" title="Add New Entry">+</button>
        <button class="control-button" onclick="saveData()" title="Save Changes">ðŸ’¾</button>
    </div>

    <!-- Modal for adding/editing entries -->
    <div class="modal" id="entryModal">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Add New Entry</h2>
            <form id="entryForm">
                <div class="form-group">
                    <label class="form-label" for="entryName">Name</label>
                    <input type="text" class="form-input" id="entryName" required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="entryType">Type</label>
                    <select class="form-select" id="entryType" required>
                        <option value="character">Character</option>
                        <option value="location">Location</option>
                        <option value="concept">Concept</option>
                        <option value="timeline">Timeline Event</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" for="entryDescription">Description</label>
                    <textarea class="form-textarea" id="entryDescription" placeholder="Brief description..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="entryPhysical">Physical Description / Key Details</label>
                    <textarea class="form-textarea" id="entryPhysical" placeholder="Appearance, key characteristics..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="entryBackground">Background / History</label>
                    <textarea class="form-textarea" id="entryBackground" placeholder="History, relationships, important events..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="entryReferences">Story References</label>
                    <input type="text" class="form-input" id="entryReferences" placeholder="Comma-separated story titles or numbers...">
                </div>
                <div class="form-group">
                    <label class="form-label" for="entryNotes">Additional Notes</label>
                    <textarea class="form-textarea" id="entryNotes" placeholder="Inconsistencies to fix, future story ideas..."></textarea>
                </div>
                <div class="form-buttons">
                    <button type="button" class="button button-secondary" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="button button-primary">Save Entry</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Character Bible Data Storage
        let characterBible = {
            entries: [],
            lastModified: new Date().toISOString()
        };

        // Initialize with sample data
        const sampleData = {
            entries: [
                {
                    id: 'brokkr',
                    name: 'Brokkr',
                    type: 'character',
                    description: 'Master craftsman and creator of seedcraft, central character of the saga',
                    physical: 'Hair color: [NEEDS CONFIRMATION - brown in images?], Dwarf/humanoid, tattoos/rune-scars from captivity',
                    background: 'Known for creating MjÃ¶lnir, imprisoned in Muspelheim, developed seedcraft, formed Forge Council',
                    references: ['The Forge Wager', 'The Forge Trial', 'The Forge Council', 'All stories'],
                    notes: 'CONSISTENCY CHECK: Hair color, exact duration of imprisonments, timeline of major events'
                },
                {
                    id: 'elri',
                    name: 'Elri',
                    type: 'character',
                    description: 'Brokkr\'s wife, seed-tender with Vanir heritage',
                    physical: 'Hair color: [INCONSISTENT - copper-red in text vs brown/blonde in images?], Human or half-dwarf',
                    background: 'From Vanaheim, works with growth-magic, mother to Nostri',
                    references: ['The Forge Bond', 'The Phoenix Flame'],
                    notes: 'MAJOR INCONSISTENCY: Physical description needs standardization across all appearances'
                },
                {
                    id: 'nostri',
                    name: 'Nostri',
                    type: 'character',
                    description: 'Brokkr and Elri\'s daughter, inherits seedcraft abilities',
                    physical: 'Hair color: [NEEDS CONFIRMATION], Age progression throughout stories',
                    background: 'Birth-day mentioned as three weeks after Brokkr\'s in Story 10',
                    references: ['The Forge Daughter', 'The Forge Bond'],
                    notes: 'Track age progression and ability development across timeline'
                },
                {
                    id: 'muspelheim_imprisonment',
                    name: 'Muspelheim Imprisonment',
                    type: 'timeline',
                    description: 'Brokkr\'s captivity among the fire giants',
                    physical: 'Duration: [NEEDS VERIFICATION - 8 years in Bond, other durations mentioned elsewhere?]',
                    background: 'Led to learning fire-giant techniques, influenced his craft development',
                    references: ['The Forge Trial', 'The Forge Bond'],
                    notes: 'CRITICAL: Verify exact duration and timing relative to other events'
                },
                {
                    id: 'phoenix_seeds',
                    name: 'Phoenix Seeds',
                    type: 'concept',
                    description: 'Fire-resistant seeds that grew stronger after the seedforge fire',
                    physical: 'Born from destruction, carrying memory of what was lost',
                    background: 'Developed after fire destroyed Brokkr and Elri\'s homestead',
                    references: ['The Forge Bond', 'The Phoenix Flame', 'The Forge Memory'],
                    notes: 'Track origin story consistency and properties across mentions'
                }
            ],
            lastModified: new Date().toISOString()
        };

        // Load data from localStorage or use sample data
        function loadData() {
            const saved = localStorage.getItem('brokkr-character-bible');
            if (saved) {
                try {
                    characterBible = JSON.parse(saved);
                } catch (e) {
                    console.error('Error loading saved data:', e);
                    characterBible = sampleData;
                }
            } else {
                characterBible = sampleData;
            }
            renderEntries();
        }

        // Save data to localStorage
        function saveData() {
            characterBible.lastModified = new Date().toISOString();
            localStorage.setItem('brokkr-character-bible', JSON.stringify(characterBible));
            
            // Visual feedback
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = 'âœ“';
            button.style.backgroundColor = '#4CAF50';
            setTimeout(() => {
                button.innerHTML = originalText;
                button.style.backgroundColor = 'var(--accent-color)';
            }, 1000);
        }

        // Render entries in the grid
        function renderEntries(filteredEntries = null) {
            const grid = document.getElementById('contentGrid');
            const entries = filteredEntries || characterBible.entries;
            
            if (entries.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: var(--secondary-text); grid-column: 1 / -1;">No entries found. Add some entries to get started!</p>';
                return;
            }
            
            grid.innerHTML = entries.map(entry => `
                <div class="entry-card" data-type="${entry.type}">
                    <div class="entry-header">
                        <div class="entry-name">${entry.name}</div>
                        <div class="entry-type">${entry.type}</div>
                    </div>
                    ${entry.description ? `
                        <div class="entry-section">
                            <div class="section-title">Description</div>
                            <div class="section-content">${entry.description}</div>
                        </div>
                    ` : ''}
                    ${entry.physical ? `
                        <div class="entry-section">
                            <div class="section-title">Physical/Key Details</div>
                            <div class="section-content">${entry.physical}</div>
                        </div>
                    ` : ''}
                    ${entry.background ? `
                        <div class="entry-section">
                            <div class="section-title">Background</div>
                            <div class="section-content">${entry.background}</div>
                        </div>
                    ` : ''}
                    ${entry.references && entry.references.length > 0 ? `
                        <div class="entry-section">
                            <div class="section-title">Story References</div>
                            <div class="story-references">
                                ${entry.references.map(ref => `<span class="story-tag">${ref}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                    ${entry.notes ? `
                        <div class="entry-section">
                            <div class="section-title">Notes</div>
                            <div class="section-content">${entry.notes}</div>
                        </div>
                    ` : ''}
                    <div style="margin-top: 15px; text-align: right;">
                        <button class="button button-secondary" onclick="editEntry('${entry.id}')" style="margin-right: 10px;">Edit</button>
                        <button class="button button-secondary" onclick="deleteEntry('${entry.id}')">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Search and filter functionality
        document.getElementById('searchBox').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const activeType = document.querySelector('.tab-button.active').dataset.type;
            
            let filtered = characterBible.entries;
            
            if (activeType !== 'all') {
                filtered = filtered.filter(entry => entry.type === activeType);
            }
            
            if (searchTerm) {
                filtered = filtered.filter(entry => 
                    entry.name.toLowerCase().includes(searchTerm) ||
                    entry.description.toLowerCase().includes(searchTerm) ||
                    entry.physical.toLowerCase().includes(searchTerm) ||
                    entry.background.toLowerCase().includes(searchTerm) ||
                    entry.notes.toLowerCase().includes(searchTerm)
                );
            }
            
            renderEntries(filtered);
        });

        // Tab filtering
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                
                const searchTerm = document.getElementById('searchBox').value.toLowerCase();
                const type = this.dataset.type;
                
                let filtered = characterBible.entries;
                
                if (type !== 'all') {
                    filtered = filtered.filter(entry => entry.type === type);
                }
                
                if (searchTerm) {
                    filtered = filtered.filter(entry => 
                        entry.name.toLowerCase().includes(searchTerm) ||
                        entry.description.toLowerCase().includes(searchTerm) ||
                        entry.physical.toLowerCase().includes(searchTerm) ||
                        entry.background.toLowerCase().includes(searchTerm) ||
                        entry.notes.toLowerCase().includes(searchTerm)
                    );
                }
                
                renderEntries(filtered);
            });
        });

        // Modal functions
        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Add New Entry';
            document.getElementById('entryForm').reset();
            document.getElementById('entryForm').removeAttribute('data-editing');
            document.getElementById('entryModal').style.display = 'block';
        }

        function editEntry(id) {
            const entry = characterBible.entries.find(e => e.id === id);
            if (!entry) return;
            
            document.getElementById('modalTitle').textContent = 'Edit Entry';
            document.getElementById('entryName').value = entry.name;
            document.getElementById('entryType').value = entry.type;
            document.getElementById('entryDescription').value = entry.description || '';
            document.getElementById('entryPhysical').value = entry.physical || '';
            document.getElementById('entryBackground').value = entry.background || '';
            document.getElementById('entryReferences').value = entry.references ? entry.references.join(', ') : '';
            document.getElementById('entryNotes').value = entry.notes || '';
            
            document.getElementById('entryForm').setAttribute('data-editing', id);
            document.getElementById('entryModal').style.display = 'block';
        }

        function deleteEntry(id) {
            if (confirm('Are you sure you want to delete this entry?')) {
                characterBible.entries = characterBible.entries.filter(e => e.id !== id);
                renderEntries();
                saveData();
            }
        }

        function closeModal() {
            document.getElementById('entryModal').style.display = 'none';
        }

        // Form submission
        document.getElementById('entryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const editingId = form.getAttribute('data-editing');
            
            const entry = {
                id: editingId || Date.now().toString(),
                name: document.getElementById('entryName').value.trim(),
                type: document.getElementById('entryType').value,
                description: document.getElementById('entryDescription').value.trim(),
                physical: document.getElementById('entryPhysical').value.trim(),
                background: document.getElementById('entryBackground').value.trim(),
                references: document.getElementById('entryReferences').value
                    .split(',')
                    .map(ref => ref.trim())
                    .filter(ref => ref.length > 0),
                notes: document.getElementById('entryNotes').value.trim()
            };
            
            if (editingId) {
                const index = characterBible.entries.findIndex(e => e.id === editingId);
                if (index !== -1) {
                    characterBible.entries[index] = entry;
                }
            } else {
                characterBible.entries.push(entry);
            }
            
            renderEntries();
            closeModal();
            saveData();
        });

        // Export/Import functions
        function exportData() {
            const dataStr = JSON.stringify(characterBible, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `brokkr-character-bible-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (confirm('This will replace all current data. Are you sure?')) {
                        characterBible = importedData;
                        renderEntries();
                        saveData();
                    }
                } catch (error) {
                    alert('Error importing file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('entryModal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
        });
    </script>
</body>
</html>
